<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Earning Master</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10318378' data-sdk='show_10318378'></script>

    <style>
        :root { --bg: #0b1426; --neon: #00f0ff; --glass: rgba(255, 255, 255, 0.08); }
        body { margin: 0; padding: 15px; background: var(--bg); color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        .header { width: 100%; display: flex; justify-content: space-between; align-items: center; }
        .social-btns { display: flex; gap: 8px; flex-wrap: wrap; }
        .s-btn { width: 35px; height: 35px; border: 1px solid var(--neon); border-radius: 8px; background: var(--glass); color: #fff; display: grid; place-items: center; cursor: pointer; }
        .notice { width: 100%; background: rgba(0,0,0,0.3); color: yellow; font-size: 12px; padding: 5px 0; margin: 10px 0; border-bottom: 1px solid var(--neon); overflow: hidden; }
        .orb { width: 130px; height: 130px; border-radius: 50%; border: 4px solid var(--neon); box-shadow: 0 0 15px var(--neon); display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 15px 0; }
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-bottom: 15px; }
        .s-box { background: var(--glass); padding: 8px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .s-box small { font-size: 10px; opacity: 0.7; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; }
        .btn { padding: 15px 5px; border-radius: 12px; border: 1px solid var(--neon); background: var(--glass); color: #fff; font-weight: bold; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 12px; }
        .btn-disabled { opacity: 0.4; pointer-events: none !important; filter: grayscale(1); }
        .new-btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; margin-top: 15px; }
        #toast { position: fixed; bottom: 20px; background: #000; padding: 10px 20px; border-radius: 20px; visibility: hidden; border: 1px solid var(--neon); z-index: 999; }
        .section { display: none; width: 100%; }
        #mainSection { display: block; }
        .back-btn { width: 100%; margin-bottom: 15px; }
    </style>
</head>
<body>

    <!-- ‡¶Æ‡ßá‡¶á‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
    <div id="mainSection" class="section">
        <div class="header">
            <div class="social-btns">
                <div class="s-btn" onclick="window.open('https://youtube.com/@alex-42-41')"><i class="fab fa-youtube"></i></div>
                <div class="s-btn" onclick="window.open('https://facebook.com/share/1UQCaxE29T/')"><i class="fab fa-facebook"></i></div>
                <div class="s-btn" onclick="window.open('https://t.me/ratulhossain56')"><i class="fab fa-telegram"></i></div>
                <div class="s-btn" onclick="copyL('https://otieu.com/4/10315373', 'Monetag')"><i class="fas fa-link"></i></div>
                <div class="s-btn" onclick="copyL('https://www.effectivegatecpm.com/e0xpfuhe?key=fb81fa455f0ff2d6a8fa09ce5d18dd57', 'Adstar')"><i class="fas fa-copy"></i></div>
                <div class="s-btn" onclick="copyAdGemLink()"><i class="fas fa-gem"></i></div>
            </div>
            <div style="font-size: 11px; text-align: right;">Welcome, <br><span id="uName">USER</span></div>
        </div>

        <div class="notice">
            <marquee behavior="scroll" direction="left" scrollamount="5">üîî ‡ß© ‡¶ú‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§ Adstar ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ‡¶°‡¶º‡¶¨‡ßá ‡¶®‡¶æ ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ì ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶®‡ßç‡¶°‡¶ø‡¶∂‡¶® ‡¶™‡ßÇ‡¶∞‡¶£‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶¨‡ßá)‡•§</marquee>
        </div>

        <div class="orb"><span style="font-size:35px; font-weight:bold" id="pDisp">0</span><small>POINTS</small></div>

        <div class="stats">
            <div class="s-box"><small>Monetag Today</small><br><strong id="mCount">0/20</strong></div>
            <div class="s-box"><small>Adstar Today</small><br><strong id="aCount">0/10</strong></div>
            <div class="s-box"><small>Total Ads</small><br><strong id="tCount">0</strong></div>
            <div class="s-box"><small>Total Refer</small><br><strong id="rCount">0</strong></div>
        </div>

        <div class="btn-grid">
            <button class="btn" id="mBtn" onclick="watchM()"><i class="fas fa-play"></i><span id="mText">MONETAG AD</span></button>
            <button class="btn" id="aBtn" onclick="watchA()"><i class="fas fa-star"></i><span id="aText">ADSTAR AD</span></button>
            <button class="btn" onclick="doWithdraw()"><i class="fas fa-wallet"></i>WITHDRAW</button>
            <button class="btn" onclick="doRefer()"><i class="fas fa-users"></i>REFER EARN</button>
        </div>

        <button class="btn" style="width:100%; margin-top:15px; background:rgba(255, 59, 48, 0.2); border-color:#ff3b30;" onclick="tg.close()">
            <i class="fas fa-power-off"></i> EXIT APP
        </button>

        <div class="new-btn-grid">
            <button class="btn" onclick="showSection('cpxSection')"><i class="fas fa-poll"></i>CPX SURVEYS</button>
            <button class="btn" onclick="showSection('adgemSection')"><i class="fas fa-gem"></i>ADGEM OFFERS</button>
        </div>
    </div>

    <!-- CPX ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
    <div id="cpxSection" class="section">
        <button class="btn back-btn" onclick="showSection('mainSection')"><i class="fas fa-arrow-left"></i> Back to Main</button>
        <div style="font-size: 11px; text-align: center; margin-bottom: 10px;">Welcome, <span id="cpxUName">USER</span></div>
        <div class="orb"><span style="font-size:35px; font-weight:bold" id="cpxDisp">0</span><small>CPX POINTS</small></div>
        <button class="btn" style="width:100%;" onclick="loadCPX()"><i class="fas fa-poll"></i> Load CPX Surveys</button>
        <div id="cpx-container" style="display:none; width:100%; height:600px; margin-top:15px;">
            <iframe id="cpx-iframe" width="100%" height="100%" frameborder="0"></iframe>
        </div>
    </div>

    <!-- AdGem ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
    <div id="adgemSection" class="section">
        <button class="btn back-btn" onclick="showSection('mainSection')"><i class="fas fa-arrow-left"></i> Back to Main</button>
        <div style="font-size: 11px; text-align: center; margin-bottom: 10px;">Welcome, <span id="adgemUName">USER</span></div>
        <div class="orb"><span style="font-size:35px; font-weight:bold" id="adgemDisp">0</span><small>ADGEM POINTS</small></div>
        <button class="btn" style="width:100%;" onclick="loadAdGem()"><i class="fas fa-gem"></i> Load AdGem Offers</button>
        <div id="adgem-container" style="display:none; width:100%; height:600px; margin-top:15px;">
            <iframe id="adgem-iframe" width="100%" height="100%" frameborder="0"></iframe>
        </div>
    </div>

    <div id="toast">Notice</div>

    <script>
        const BACKEND = "https://monetagads4241r.onrender.com";
        const ADSTAR_URL = "https://www.effectivegatecpm.com/e0xpfuhe?key=fb81fa455f0ff2d6a8fa09ce5d18dd57";
        const ADGEM_DIRECT_LINK = "https://api.adgem.com/v1/wall?appid=31665&playerid=";
        const CPX_APP_ID = 30520;
        const CPX_SECURE_KEY = "0UO1OjWFA1DzWsmbSlsNL6zgRJ0ovYed";
        const tg = window.Telegram.WebApp;
        tg.expand();

        const firebaseConfig = {
          apiKey: "AIzaSyBHgVkLJu7ROlQYcvx7sxDJjEJymZkXEdR",
          authDomain: "monetas-ads-4241.firebaseapp.com",
          projectId: "monetas-ads-4241",
          storageBucket: "monetas-ads-4241.firebasestorage.app",
          messagingSenderId: "482009819786",
          appId: "1:482009819786:web:8606ae48b666bfd9a1db73"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let uid = String(tg.initDataUnsafe?.user?.id || "test_user");
        let startParam = tg.initDataUnsafe.start_param || '';

        const uName = (tg.initDataUnsafe?.user?.first_name || "Guest").toUpperCase();
        document.getElementById('uName').innerText = uName;
        document.getElementById('cpxUName').innerText = uName;
        document.getElementById('adgemUName').innerText = uName;

        let timers = { m: null, a: null };

        db.collection('users').doc(uid).onSnapshot(doc => {
            if(doc.exists) {
                const d = doc.data();
                document.getElementById('pDisp').innerText = d.coins || 0;
                document.getElementById('rCount').innerText = d.referrals || 0;
                document.getElementById('cpxDisp').innerText = d.cpxPoints || 0;
                document.getElementById('adgemDisp').innerText = d.adgemPoints || 0;
                
                const today = new Date().toISOString().slice(0, 10);
                const mToday = d.lastAdDate === today ? (d.adsToday || 0) : 0;
                const aToday = d.lastAdstarDate === today ? (d.adstarToday || 0) : 0;
                
                document.getElementById('mCount').innerText = `${mToday}/20`;
                document.getElementById('aCount').innerText = `${aToday}/10`;
                document.getElementById('tCount').innerText = (d.totalAdsWatched || 0);
                
                checkTimers(d.lastAdTime, d.lastAdstarTime, mToday, aToday);
            }
        });

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
        }

        // ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (watchM, watchA, timers, copyL, copyAdGemLink, doRefer, doWithdraw, loadCPX, loadAdGem) ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶ï‡ßã‡¶° ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶ï‡¶á ‡¶∞‡¶æ‡¶ñ‡ßã
        // loadCPX ‡¶è‡¶¨‡¶Ç loadAdGem ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßã (iframe ‡¶≤‡ßã‡¶°)

        function loadCPX() {
            const iframe = document.getElementById('cpx-iframe');
            const container = document.getElementById('cpx-container');
            const secure_hash = md5(uid + '-' + CPX_SECURE_KEY);
            iframe.src = `https://offers.cpx-research.com/index.php?app_id=\( {CPX_APP_ID}&ext_user_id= \){uid}&secure_hash=${secure_hash}`;
            container.style.display = 'block';
            showToast("CPX Surveys Loaded!");
        }

        function loadAdGem() {
            const iframe = document.getElementById('adgem-iframe');
            const container = document.getElementById('adgem-container');
            iframe.src = ADGEM_DIRECT_LINK + uid;
            container.style.display = 'block';
            showToast("AdGem Offers Loaded!");
        }

        function copyAdGemLink() {
            navigator.clipboard.writeText(ADGEM_DIRECT_LINK + uid);
            showToast("AdGem Link Copied!");
        }

        // ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶ï‡ßã‡¶° ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßã (watchM, watchA, timers ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø)

        fetch(`${BACKEND}/api/sync`, {method:'POST', headers:{'x-telegram-init-data': tg.initData, 'x-start-param': startParam}});
    </script>
</body>
    </html>
