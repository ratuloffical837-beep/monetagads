<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro-Earn Mini App</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script src='//libtl.com/sdk.js' data-zone='10318378' data-sdk='show_10318378'></script>

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* --- PROFESSIONAL UI/UX STYLES --- */
        :root {
            --bg: #0d1117; /* Darker, cleaner background */
            --glass: rgba(255, 255, 255, 0.08);
            --neon-blue: #00b0ff; /* Clean Blue */
            --neon-purple: #9c27b0;
            --neon-orange: #ff9800;
            --text-main: #e6edf3; /* Light Grey Text */
            --input-bg: #161b22;
            --button-main: #007bff; /* Primary Blue */
            --button-edge: #0056b3;
            --danger-red: #d32f2f;
            --adsterra: #e91e63; /* Pink */
            --cpx: #4caf50; /* Green */
            --lootably: #ffc107; /* Yellow */
        }
        body, html { margin: 0; padding: 0; background: var(--bg); color: var(--text-main); font-family: 'Rajdhani', sans-serif; overflow-x: hidden; }
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        
        /* 3D Button Styling (Refined) */
        .btn-3d { 
            background: var(--button-main); color: var(--text-main); font-weight: 700; font-size: 16px;
            padding: 0; border: none; cursor: pointer; position: relative;
            outline: none; box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: transform 0.1s, box-shadow 0.1s;
            border-radius: 8px; /* Slightly rounded */
        }
        .btn-face {
            display: block; padding: 12px 15px; background: var(--button-main); border-radius: 8px;
            box-shadow: 0 0 15px rgba(var(--button-main), 0.4); 
            transition: all 0.1s;
        }
        .btn-edge { 
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            background: var(--button-edge); border-radius: 8px; transform: translate3d(0, 4px, -1px); 
        }
        .btn-3d:active { 
            transform: translate(0, 4px); box-shadow: none; 
        }
        .btn-3d:active .btn-face { 
            transform: translateY(0); 
        }
        
        .btn-primary { --button-main: var(--neon-blue); --button-edge: #007bb3; }
        .btn-secondary { --button-main: var(--neon-purple); --button-edge: #7b1fa2; } 
        .btn-refer { --button-main: #10b981; --button-edge: #047857; }
        .btn-danger { --button-main: var(--danger-red); --button-edge: #b71c1c; }
        .btn-adsterra { --button-main: var(--adsterra); --button-edge: #c2185b; } 
        
        /* Locked Button Style */
        .btn-locked { 
            --button-main: #343a40; /* Darker grey */
            --button-edge: #212529; 
            cursor: not-allowed; 
            opacity: 0.7;
            filter: none;
        }
        .btn-locked:active {
            transform: none;
            box-shadow: none;
        }

        /* Grid Menu */
        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; max-width: 450px; margin: 25px auto 0; }
        .grid-menu-full { grid-column: span 2; }
        
        /* Orb and Stats (Cleaned up) */
        .orb-stage { text-align: center; margin: 30px auto 10px; position: relative; }
        .orb { width: 150px; height: 150px; background: var(--glass); border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 3px solid var(--neon-blue); box-shadow: 0 0 25px var(--neon-blue); margin: 0 auto; }
        .points-val { font-size: 3em; font-weight: 900; color: var(--text-main); font-family: 'Orbitron', sans-serif; }
        .points-label { font-size: 0.8em; color: #aaa; }
        .balance-info { text-align: center; font-size: 1em; color: var(--neon-purple); font-weight: 500; margin-bottom: 20px; }
        .stats-panel { display: flex; justify-content: space-around; max-width: 450px; margin: 0 auto 20px; padding: 10px 0; border-top: 1px solid #333; border-bottom: 1px solid #333; }
        .stat-item { font-size: 0.9em; color: #ccc; }
        
        /* Modal and Toast (Cleaned) */
        /* ... (Rest of Modal and Toast CSS remains the same) ... */
        .modal { padding: 30px; border-radius: 12px; background: var(--input-bg); }
        .toast { background: var(--neon-blue); border-radius: 6px; }
        .toast.error { background: var(--danger-red); }
    </style>
</head>
<body>

    <div class="top-header-bar">
        </div>
    
    <div class="marquee-container">
        </div>

    <div class="orb-stage">
        <div class="orb" id="orbBtn">
            <span class="points-val" id="pointsDisplay">0</span>
            <span class="points-label">WITHDRAWAL POINTS</span>
        </div>
    </div>
    
    <div class="balance-info">
        SECURE POSTBACK POINTS (Verified Tasks): 
        <strong id="validPointsDisplay">0</strong>
    </div>

    <div class="stats-panel">
        <div class="stat-item">Ads Today: <strong id="adsTodayDisplay">0/60</strong></div>
        <div class="stat-item">Total Tasks: <strong id="totalAdsDisplay">0</strong></div>
        <div class="stat-item">Refs: <strong id="refsDisplay">0</strong></div>
    </div>

    <div class="grid-menu">
        <button class="btn-3d btn-primary" id="watchAdBtn" onclick="watchAd()">
            <span class="btn-edge"></span><span class="btn-face" id="watchAdFace">üëÄ WATCH ADS (Monetag)</span>
        </button>
        
        <button class="btn-3d btn-adsterra" onclick="openAdsterraModal()">
            <span class="btn-edge"></span><span class="btn-face">‚ö° QUICK ADS (Adsterra)</span>
        </button>

        <button class="btn-3d btn-locked" onclick="openLockedFeature('AdGem')">
            <span class="btn-edge"></span><span class="btn-face">üîí HIGH TASKS (AdGem)</span>
        </button>
        
        <button class="btn-3d btn-locked" onclick="openLockedFeature('CPX Research')">
            <span class="btn-edge"></span><span class="btn-face">üîí SURVEYS (CPX)</span>
        </button>
        
        <button class="btn-3d btn-locked" onclick="openLockedFeature('Lootably')">
            <span class="btn-edge"></span><span class="btn-face">üîí MORE TASKS (Lootably)</span>
        </button>

        <button class="btn-3d btn-secondary" onclick="openModal('withdrawModal')">
            <span class="btn-edge"></span><span class="btn-face">üí∏ WITHDRAW (600/10)</span>
        </button>

        <button class="btn-3d btn-refer grid-menu-full" onclick="openReferralModal()">
            <span class="btn-edge"></span><span class="btn-face">ü§ù REFER & EARN (+1 PT per Ref)</span>
        </button>
    </div>
    
    <button class="btn-3d btn-danger" onclick="Telegram.WebApp.close()" style="margin-top: 20px; width: 100%; max-width: 450px;">
        <span class="btn-edge"></span><span class="btn-face">EXIT APP</span>
    </button>


    <div class="modal-overlay" id="adsterraModal">
        <div class="modal">
            <h2>‚ö° Quick Ads (Adsterra)</h2>
            <p style="font-size: 14px; color: var(--adsterra); margin-bottom: 20px;">
                Adsterra ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø START ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞, ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
            </p>
            
            <button class="btn-3d btn-adsterra" onclick="openExternalAdsterraLink()">
                <span class="btn-edge"></span><span class="btn-face"><i class="fas fa-external-link-alt"></i> START ADS</span>
            </button>
            
            <button class="btn-3d btn-primary" onclick="claimAdsterraReward()" style="margin-top: 15px;">
                <span class="btn-edge"></span><span class="btn-face"><i class="fas fa-check-circle"></i> CLAIM 1 POINT</span>
            </button>
            
            <button class="btn-3d btn-danger" onclick="closeModal('adsterraModal')" style="margin-top:15px;">
                <span class="btn-edge"></span><span class="btn-face">CLOSE</span>
            </button>
        </div>
    </div>
    
    <div class="toast" id="toast">Notification</div>

    <script>
        // --- CONFIGURATION ---
        const BACKEND_URL = "https://monetagads4241r.onrender.com"; 
        const TELEGRAM_BOT_USERNAME = "realldoler87ok_bot"; 
        const MONETAG_FUNC = "show_10318378"; 
        const DIRECT_LINK = "https://otieu.com/4/10315373"; 
        const ADSTERRA_POP_LINK = "https://smart-link-3065388"; 
        
        const firebaseConfig = {
          apiKey: "AIzaSyBHgVkLJu7ROlQYcvx7sxDJjEJymZkXEdE",
          authDomain: "monetas-ads-4241.firebaseapp.com",
          projectId: "monetas-ads-4241",
          storageBucket: "monetas-ads-4241.firebasestorage.app",
          messagingSenderId: "482009819786",
          appId: "1:482009819786:web:8606ae48b666bfd9a1db73"
        };
        
        // ... (rest of the functions remain the same) ...
        // ... (initApp, updateUI, checkAdStatus, watchAd, claimAdsterraReward, claimReward, submitWithdraw) ...
        
        function openExternalAdsterraLink() {
            if (!ADSTERRA_POP_LINK || ADSTERRA_POP_LINK.includes('YOUR_')) return showToast("Adsterra Link Missing!", true);
            window.open(ADSTERRA_POP_LINK, '_blank'); 
            showToast("Opening Adsterra Popunder...", false, 3000);
        }
        
        function openLockedFeature(networkName) {
            showToast(`${networkName} ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá‡•§ ‡¶è‡¶ü‡¶ø ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§`, true, 5000);
        }

        // ... (rest of the UTILS functions remain the same) ...
        initApp();
    </script>
</body>
    </html>
